{% extends 'carwash/base.html' %}
{% load static %}

{% block content %}
<!-- –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç CSS –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π CSS —Ñ–∞–π–ª -->

<!-- 1. –ì–µ—Ä–æ–π-–±–∞–Ω–Ω–µ—Ä —Å –∫–Ω–æ–ø–∫–æ–π –∑–∞–ø–∏—Å–∏ -->
<section class="hero-banner py-5 text-center text-white">
    <div class="container">
        <h1 class="display-4 mb-4">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –º–æ–π–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h1>
        <p class="lead mb-4">–í–µ—Ä–Ω–µ–º –≤–∞—à–µ–º—É –∞–≤—Ç–æ –±–µ–∑—É–ø—Ä–µ—á–Ω—ã–π –≤–∏–¥ –∑–∞ 20 –º–∏–Ω—É—Ç!</p>
        <a href="#booking" class="btn btn-primary btn-lg">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω</a>
        <link rel="stylesheet" href="css/styles.css">
    </div>
</section>

<!-- 2. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (3 –∫–æ–ª–æ–Ω–∫–∏) -->
<section class="advantages py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å?</h2>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow">
                    <div class="card-body text-center">
                        <div class="fs-1 mb-3">üöó</div>
                        <h3>–ë—ã—Å—Ç—Ä–æ</h3>
                        <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–æ–π–∫–∏ ‚Äî 15-20 –º–∏–Ω—É—Ç</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow">
                    <div class="card-body text-center">
                        <div class="fs-1 mb-3">üíé</div>
                        <h3>–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ</h3>
                        <p>–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —Ö–∏–º–∏—é</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow">
                    <div class="card-body text-center">
                        <div class="fs-1 mb-3">üõ°Ô∏è</div>
                        <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ</h3>
                        <p>–ë–µ—Ä–µ–∂–Ω–∞—è –º–æ–π–∫–∞ –±–µ–∑ —Ü–∞—Ä–∞–ø–∏–Ω</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Å–µ–∫—Ü–∏—é —É—Å–ª—É–≥ –∏ –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ —ç—Ç—É -->

<section class="process-steps py-5">
    <div class="container">
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto text-center">
                <h2 class="display-4 mb-4">–ù–∞—à –ø—Ä–æ—Ü–µ—Å—Å –º–æ–π–∫–∏</h2>
                <p class="lead text-muted">4 —ç—Ç–∞–ø–∞ –∏–¥–µ–∞–ª—å–Ω–æ–π —á–∏—Å—Ç–æ—Ç—ã –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</p>
            </div>
        </div>

        <div class="row g-4 position-relative">
            <!-- –õ–∏–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
            <div class="progress-line"></div>

            <!-- –®–∞–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ -->
            <div class="col-md-3">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3 class="step-title">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h3>
                    <ul class="step-list">
                        <li>–£–¥–∞–ª–µ–Ω–∏–µ –≥—Ä—É–±—ã—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π</li>
                        <li>–ù–∞–Ω–µ—Å–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–µ–Ω—ã</li>
                        <li>–û—á–∏—Å—Ç–∫–∞ –∫–æ–ª–µ—Å–Ω—ã—Ö –∞—Ä–æ–∫</li>
                    </ul>
                    <div class="step-duration">~10 –º–∏–Ω—É—Ç</div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3 class="step-title">–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–π–∫–∞</h3>
                    <ul class="step-list">
                        <li>–ë–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –º–æ–π–∫–∞ –∫—É–∑–æ–≤–∞</li>
                        <li>–û—á–∏—Å—Ç–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö –ø–æ–ª–æ—Å—Ç–µ–π</li>
                        <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º—è–≥–∫–∏—Ö —â–µ—Ç–æ–∫</li>
                    </ul>
                    <div class="step-duration">~15 –º–∏–Ω—É—Ç</div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3 class="step-title">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</h3>
                    <ul class="step-list">
                        <li>–†—É—á–Ω–∞—è —Å—É—à–∫–∞ –º–∏–∫—Ä–æ—Ñ–∏–±—Ä–æ–π</li>
                        <li>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑–∏–Ω–æ–≤—ã—Ö —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª–µ–π</li>
                        <li>–ü–æ–ª–∏—Ä–æ–≤–∫–∞ —Ñ–∞—Ä</li>
                    </ul>
                    <div class="step-duration">~20 –º–∏–Ω—É—Ç</div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="step-card">
                    <div class="step-number">4</div>
                    <h3 class="step-title">–§–∏–Ω–∏—à–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å</h3>
                    <ul class="step-list">
                        <li>–û—Å–º–æ—Ç—Ä –∫–∞—á–µ—Å—Ç–≤–∞</li>
                        <li>–ê—Ä–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–∞–ª–æ–Ω–∞</li>
                        <li>–ó–∞—â–∏—Ç–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ</li>
                    </ul>
                    <div class="step-duration">~10 –º–∏–Ω—É—Ç</div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.step-card').forEach(card => {
        card.style.animationPlayState = 'paused';
        observer.observe(card);
    });
});
</script>

<!-- 4. –§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ -->
<section class="booking py-5" id="booking">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card border-0 shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="text-center mb-4">üöó –û–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å</h2>
                        <form method="post">
                            {% csrf_token %}
                            
                            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –º–µ—Å—Ç–∞ -->
                            <input type="hidden" name="spot" id="spotInput">
                            
                            <!-- –ü–æ–ª–µ –∏–º–µ–Ω–∏ -->
                            <div class="mb-4">
                                <label class="form-label fs-5 text-secondary">–í–∞—à–µ –∏–º—è</label>
                                {{ form.name }}
                            </div>
                            
                            <!-- –ü–æ–ª–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
                            <div class="mb-4">
                                <label class="form-label fs-5 text-secondary">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                {{ form.phone }}
                            </div>
                            
                            <!-- –í—ã–±–æ—Ä —É—Å–ª—É–≥–∏ -->
                            <div class="mb-4">
                                <label class="form-label fs-5 text-secondary">–£—Å–ª—É–≥–∞</label>
                                {{ form.service }}
                            </div>
                            
                            <!-- –í—ã–±–æ—Ä –¥–∞—Ç—ã -->
                            <div class="mb-4">
                                <label class="form-label fs-5 text-secondary">–î–∞—Ç–∞</label>
                                {{ form.date }}
                            </div>
                            
                            <!-- –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ -->
                            <div class="mb-4">
                                <label class="form-label fs-5 text-secondary">–í—Ä–µ–º—è</label>
                                {{ form.time }}
                                <div class="time-select-container" id="timeContainer"></div>
                            </div>
                            
                            <!-- –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ -->
                            <div class="mb-4">
                                <label class="form-label fs-5 text-secondary">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ</label>
                                <div id="spotsContainer" class="spots-container">
                                    <!-- –ú–µ—Å—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                </div>
                            </div>
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                            <div class="d-grid mt-4">
                                <button type="submit" class="btn btn-primary btn-lg py-3">
                                    <i class="bi bi-calendar-check me-2"></i>–ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const serviceSelect = document.querySelector('[name="service"]');
    const dateInput = document.querySelector('[name="date"]');
    const spotInput = document.querySelector('[name="spot"]');
    const spotsContainer = document.getElementById('spotsContainer');
    const timeSelect = document.querySelector('[name="time"]');
    const timeContainer = document.getElementById('timeContainer');

    function loadSpots() {
        const service = serviceSelect.value;
        const date = dateInput.value;
        const time = timeSelect.value;

        if (!service || !date || !time) {
            spotsContainer.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É, –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è';
            return;
        }

        const dateTime = `${date}T${time}`;
        spotsContainer.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Å—Ç...';

        fetch(`/get-spots/?service=${service}&date=${encodeURIComponent(dateTime)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }
                
                spotsContainer.innerHTML = '';
                if (data.spots && data.spots.length > 0) {
                    data.spots.forEach(spot => {
                        const spotBox = document.createElement('div');
                        spotBox.className = `spot-box ${spot.is_available ? 'available' : 'unavailable'}`;
                        spotBox.textContent = spot.number;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É, –∫–µ–º –∑–∞–Ω—è—Ç–æ –º–µ—Å—Ç–æ
                        if (spot.booked_by) {
                            spotBox.title = `–ó–∞–Ω—è—Ç–æ: ${spot.booked_by}`;
                        }
                        
                        if (spot.is_available) {
                            spotBox.addEventListener('click', () => {
                                document.querySelectorAll('.spot-box').forEach(box => {
                                    box.classList.remove('selected');
                                });
                                spotBox.classList.add('selected');
                                spotInput.value = spot.id;
                            });
                        }
                        
                        spotsContainer.appendChild(spotBox);
                    });
                } else {
                    spotsContainer.innerHTML = '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                spotsContainer.innerHTML = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Å—Ç: ${error.message}`;
            });
    }

    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    timeSelect.querySelectorAll('option').forEach(option => {
        if (option.value) {  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç–æ–π option –µ—Å–ª–∏ –µ—Å—Ç—å
            const timeBtn = document.createElement('div');
            timeBtn.className = 'time-option';
            timeBtn.textContent = option.textContent;
            timeBtn.dataset.value = option.value;
            
            timeBtn.addEventListener('click', () => {
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.time-option').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
                timeBtn.classList.add('selected');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–∫—Ä—ã—Ç–æ–º select
                timeSelect.value = timeBtn.dataset.value;
                
                // –í—ã–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–µ—Å—Ç
                loadSpots();
            });
            
            timeContainer.appendChild(timeBtn);
        }
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ—Å—Ç–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏ –∏–ª–∏ –¥–∞—Ç—ã
    serviceSelect.addEventListener('change', loadSpots);
    dateInput.addEventListener('change', loadSpots);
    timeSelect.addEventListener('change', loadSpots);
});
</script>
{% endblock %}